# midi2vjoy

## 1. Introduction

This software provides a way to use MIDI controllers as joysticks.

A typical real joystick usually has only a few axis. This is limited by the HID specification of joystick. However, often when one plays complex games many axis of control are needed. For example, in flight simulators, the throttle, mixture, propeller, etc. all need their own control axis that is not available on common joysticks.

MIDI controllers have many sliders, and is a good candidate for use in this scenario. A few things are needed to get that to work as game controllers. Fortunately, a software called vJoy (http://vjoystick.sourceforge.net) can emulate joysticks in the system. This software reads the input from MIDI controllers, and drives the virtual joysticks created by vJoy.

This code is available through "Simplified BSD License".

## 2. How to use it

### 2.1. Overview

I will use the M-Audio Xsession-Pro as an example to show you how to use the midi2vjoy software.

1. Download and install vJoy from http://vjoystick.sourceforge.net/.
2. Use the vJoyConf tool ("vJoy" ->"Configure vJoy") to define the virtual joysticks, [see details in 2.2](#22-configure-vjoy).
3. Install midi2vjoy software using `python setup.py install` (run as admin if using a standard user account)
4. Run "midi2vjoy -t" to test the code generated by MIDI device. These codes will be used for the configuration, so midi2vjoy know this vjoy axis or button to drive then the MIDI device is used, [see details in 2.3](#23-test-midi-device).
5. Write/edit the mapping configuration file, [see details in 2.4](#24-edit-mapping-configuration-file).
6. Run "midi2vjoy -m *midi* -c *conf*", where midi is the midi device and conf is the configuration file.

### 2.2. Configure vJoy

We need to configure the virtual joysticks based on the MIDI device we like to use. Here I use M-Audio Xsession-Pro as example. Xsession-Pro has 17 sliders and 10 buttons, so I divide that into three virtual joysticks.

![xsessionpro](/readme_images/xsessionpro.png)

With that, we will need to configure three virtual joysticks with vJoyConf tool. They are configured as following.

- vJoy #1: Z, Rx, Ry, Rz, Slider, and 8 Buttons;
- vJoy #2: Z, Rx, Ry, Rz, Slider, Slider2, and 1 Button;
- vJoy #3: Z, Rx, Ry, Rz, Slider, Slider2, and 1 Button.

### 2.3. Test MIDI device

To test the MIDI device, just run "midi2vjoy -t". First the program will print out a list of available MIDI input devices for you to choose. You will need to select the MIDI you want to use. For my Xsession-pro, it is number 1.

When the device is opened, you can mode the axis and press the buttons. The MIDI code that are sent by the MIDI device will be displayed on the screen. Just write down the first number (usually 176 for axis and 144 for buttons), and the second number (which is the index of the axis or buttons). Do this for all the axis and buttons you like to use. Use ctrl-c to exit the program.

Now you have all the necessary information to write a mapping configuration file.

In the example shown below, I am testing the MIDI interface 1. The axis I moved sent (176, 12), and the button I pressed sent (144, 46).

![test_cmd](/readme_images/test_cmd.png)

### 2.4. Edit mapping configuration file

The mapping configuration file is a simple text file. All lines starts with "#" are comments and will be ignored by the parser.

Each mapping line typically has four numbers. This correspond to mapping an axis or button from MIDI to the corresponding control on the virtual joysticks. The first two numbers are those you recorded in the midi test step above.

- m_type: This is the midi channel number
- m_control: This is the midi cc number.
- v_id: The ID of the vJoy device (1, 2, 3, etc.);
- v_number: The axis name or button number on the vJoy device ("Z" for Z axis, and 3 for Button3).

Additionally, you can choose to map a rotary midi control to a repeater rather than an axis.

To do this, duplicate an m_type and m_control pair and append 'repeat up' or 'repeat down'

For example:

m_type(144) m_control(1) v_id(1) v_number(1) repeat up

m_type(144) m_control(1) v_id(1) v_number(2) repeat down

In this example, midi channel 144 on cc number 1 will trigger the vjoy device 1, button 1 for any increase in its midi value and will trigger vjoy device 1, button 2 for any decrease in its midi value.

Typically midi buttons report values of 127 for 'on' and 0 for off and midi rotary / axis / analogue controls will report values anwywhere between 0 and 127 depending on where they are set to.

Below is an example mapping configuration file.

```
# Midi to vJoy translation
# The format is one line for each control in the format of
#       m_type  m_control   v_id    v_number
# m_type is the 176 (slider) or 144 (button).
# m_control is the ID of the midi message.
# The m_type and m_control value of each MIDI input can be found
# when running the program in test mode. Just push/move the control
# and watch the messages showing up on the screen.
# v_id is the vJoystick ID where the MIDI message is translated to.
# v_number is the axis or button number MIDI message is contolling.
# The axis may be 'X', 'Y', 'Z', 'RX', 'RY', 'RZ', 'SL0', or 'SL1'.

# A midi rotary can be assigned to repeat button presses as it increases or decreases in value.
# To accomplish this, add the 'repeat' and 'up' or 'down' to the key
# For example:
#       m_type  m_control    v_id    v_number   repeat  up
#       m_type  m_control    v_id    v_number repeat down
#
# Ensure that the m_type and m_control are the same for each line (i.e. the same midi control)
# Ensure that the v_id and v_number are different for each line (i.e. one vjoy button for 'up' and a different vjoy button for 'down')

176  1  1  1  repeat  up
176  1  1  2  repeat  down
176  2  1  Y
176  3  1  Z
176  4  1  RX
176  5  1  RY
176  6  1  RZ
176  7  1  SL0
176  8  1  SL1
144  36  1  1
144  37  1  2
144  38  1  3
144  39  1  4
144  40  1  5
144  41  1  6
144  42  1  7
144  43  1  8
144  48  1  9
144  49  1  10

177  0  2  1
177  1  2  2
177  2  2  3
177  3  2  4
177  4  2  5
177  5  2  6
177  6  2  7
177  7  2  8
177  8  2  9
177  9  2  10
177  10  2  11

```

Once you have the configuration file, just run "midi2vjoy -m midi -c conf" to enjoy.

In my case, I will run:

```
midi2vjoy -m 1 -c xsessionpro.conf
```

